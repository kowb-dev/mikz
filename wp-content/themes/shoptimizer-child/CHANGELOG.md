# Журнал изменений Shoptimizer Child

## [1.1.12] - 2024

### Исправлено
- **AJAX обновление счетчиков (финальный)**: Возвращена и улучшена логика обработчиков по клику. Добавлены более надежные селекторы для кнопок добавления/удаления и увеличена задержка для гарантированного срабатывания после AJAX-операций плагинов. Это должно окончательно решить проблему с обновлением счетчиков на всех страницах.

### Обновленные файлы
- `/assets/js/action-badges.js` v1.0.8 - Улучшены и возвращены обработчики по клику.

## [1.1.11] - 2024

### Исправлено
- **AJAX обновление счетчиков (Wishlist & Compare)**: Восстановлены стандартные обработчики событий YITH (`added_to_wishlist`, `removed_from_wishlist` и т.д.). Это обеспечивает наиболее надежное и правильное обновление счетчиков на всех страницах, включая сброс после очистки списков.

### Обновленные файлы
- `/assets/js/action-badges.js` v1.0.7 - Возвращены стандартные обработчики событий YITH.

## [1.1.10] - 2024

### Исправлено
- **AJAX обновление счетчика "Избранное"**: Изменен селектор для обработчика кликов по кнопке "Избранное", чтобы он срабатывал на всех страницах (single product, shop, category). Это решает проблему, когда счетчик не обновлялся сразу.

### Обновленные файлы
- `/assets/js/action-badges.js` v1.0.6 - Обновлен селектор для кнопки "Избранное".

## [1.1.9] - 2024

### Исправлено
- **Исчезновение иконок (Wishlist & Compare)**: Реализован постоянный `MutationObserver`, который инициализируется при загрузке страницы и следит за всеми кнопками "Избранное" и "Сравнение". Это гарантирует, что иконки будут немедленно восстановлены, если плагины YITH их удалят, решая проблему на всех страницах, включая те, что загружаются через AJAX.

### Обновленные файлы
- `/assets/js/notifications.js` v1.0.5 - Внедрен постоянный `MutationObserver` для кнопок.

## [1.1.8] - 2024

### Исправлено
- **Исчезновение иконок (Wishlist & Compare)**: Реализован `MutationObserver` для отслеживания изменений в кнопках "Избранное" и "Сравнение". Этот подход гарантирует, что иконки будут восстановлены, даже если плагины YITH удаляют их после AJAX-запроса.

### Обновленные файлы
- `/assets/js/notifications.js` v1.0.4 - Внедрен `MutationObserver` для восстановления иконок.

## [1.1.7] - 2024

### Исправлено
- **Исчезновение иконок (Wishlist & Compare)**: Добавлена JS-логика для принудительного восстановления иконок на кнопках "Избранное" и "Сравнение" после добавления товара. Это решает проблему, когда плагины YITH удаляли иконки из DOM.

### Обновленные файлы
- `/assets/js/notifications.js` v1.0.3 - Добавлена логика восстановления иконок.

## [1.1.6] - 2024

### Исправлено
- **AJAX обновление счетчиков (Shop/Category)**: Заменены ненадежные обработчики событий на `click` хендлеры с небольшой задержкой для кнопок "Избранное" и "Сравнение". Это обеспечивает гарантированное обновление счетчиков на страницах магазина и категорий.

### Обновленные файлы
- `/assets/js/action-badges.js` v1.0.4 - Заменены обработчики событий на click.

## [1.1.5] - 2024

### Исправлено
- **AJAX обновление счетчиков**: Исправлена проблема, из-за которой счетчики "Избранное" и "Сравнение" в хедере не обновлялись сразу после добавления товара. JS-события теперь корректно отслеживаются.

### Обновленные файлы
- `/assets/js/action-badges.js` v1.0.3 - Изменены обработчики событий для немедленного обновления счетчиков.

## [1.1.4] - 2024

### Исправлено
- **Стилизация кнопки "Сравнить"**: Исправлена CSS-стилизация кнопки "Сравнить" на странице товара. Теперь после нажатия иконка не исчезает, а рамка становится оранжевой, как у кнопки "Избранное".
- **Уведомления о добавлении**: Исправлена и улучшена система уведомлений. Теперь при добавлении товара в корзину, избранное или сравнение, в правом верхнем углу появляется уведомление с корректным названием товара.

### Обновленные файлы
- `/assets/css/woo_single.css` v1.0.1 - Добавлены стили для активного состояния кнопки "Сравнить".
- `/inc/features/notifications.php` v1.0.1 - Добавлена AJAX-функция для получения имени товара.
- `/assets/js/notifications.js` v1.0.1 - Переписана логика для надежного отображения уведомлений с названием товара.

## [1.1.3] - 2024

### Исправлено
- **Исчезновение кнопки "Сравнить"**: Заменен агрессивный CSS/JS хак на корректный PHP фильтр (`yith_woocompare_compare_added_label`) для скрытия уведомления "Товар добавлен к сравнению". Это предотвращает исчезновение самой кнопки после нажатия.

### Обновленные файлы
- `/inc/yith-compare-fixes.php` v1.0.2 - Заменено содержимое файла на более надежное решение.

## [1.1.2] - 2024

### Исправлено
- **Позиционирование значков**: Добавлено `position: relative;` к `.mkx-action-link` в `header.css` для корректного позиционирования значков количества товаров ("Избранное", "Сравнение") относительно их родительских элементов в хедере.

### Обновленные файлы
- `/inc/features/action-badges.php` v1.0.2 - Восстановлена функция подсчета для сравнения.
- `/assets/js/action-badges.js` v1.0.2 - Обновлены селекторы для значков.
- `/assets/css/header.css` v1.0.10 - Исправлено позиционирование значков.

## [1.1.1] - 2024

### Исправлено
- **Контекстное отображение значков**: Обновлены JS селекторы для значков "Избранное" и "Сравнение" в `action-badges.js`, чтобы они отображались только в блоке `.mkx-action-links` в хедере, а не на всех кнопках товаров.

### Обновленные файлы
- `/inc/features/action-badges.php` v1.0.2 - Восстановлена функция подсчета для сравнения.
- `/assets/js/action-badges.js` v1.0.2 - Обновлены селекторы для значков.

## [1.1.0] - 2024

### Исправлено
- **YITH Wishlist Deprecated Function**: Заменена устаревшая функция `YITH_WCWL()->get_products()` на `count( YITH_WCWL_Wishlist_Factory::get_default_wishlist()->get_items() )` в файле `action-badges.php` для устранения предупреждений на фронтенде и фатальной ошибки.
- **Удаление счетчика сравнения**: Удалена функциональность отображения счетчика товаров в сравнении рядом с кнопками сравнения на фронтенде.

### Обновленные файлы
- `/inc/features/action-badges.php` v1.0.1 - Исправлена устаревшая функция YITH Wishlist и удалена функциональность счетчика сравнения.
- `/assets/js/action-badges.js` v1.0.1 - Удалена функциональность счетчика сравнения.

## [1.0.9] - 2024

### Добавлено
- **Кастомная система уведомлений**: Красивые всплывающие уведомления при добавлении товаров в корзину, избранное и сравнение (правый верхний угол)
- **Система значков счетчиков**: Индикаторы количества товаров для корзины, избранного и сравнения на иконках в header
- **Мобильная версия /shop/**: Поле количества, цены и кнопка корзины для мобильных устройств на странице магазина
- **Принудительное скрытие YITH Compare уведомлений**: CSS и JS решение для полного удаления уведомления "Добавлено"
- **Исключение категории misc**: Товары категории misc теперь скрыты во всех WooCommerce блоках включая "Новинка в магазине"

### Новые файлы
- `/inc/features/notifications.php` - Система уведомлений
- `/inc/features/action-badges.php` - Управление значками счетчиков
- `/assets/js/notifications.js` - JS логика уведомлений
- `/assets/js/action-badges.js` - JS логика обновления значков
- `/assets/css/notifications.css` - Стили уведомлений

### Обновленные файлы
- `functions.php` v1.0.9 - Подключение новых модулей
- `header.php` v1.0.8 - Обновлена разметка значков корзины
- `/inc/integrations/woocommerce/functions.php` v1.0.4 - Улучшенные AJAX фрагменты
- `/inc/yith-compare-fixes.php` v1.0.1 - Принудительное скрытие уведомлений
- `/inc/features/query-modifications.php` v1.0.1 - Фильтры для WooCommerce блоков
- `/woocommerce/content-product-list.php` v1.6.0 - Мобильная версия количества и корзины
- `/assets/css/header.css` v1.0.9 - Стили значков с анимацией
- `/assets/css/shop-list-view.css` v1.9.0 - Адаптивные стили для мобильной версии
- `/assets/js/quantity-handler.js` - Улучшенная поддержка мобильных кнопок

### Исправлено
- Значок корзины теперь появляется сразу при первом добавлении товара (исправлена проблема с AJAX фрагментами)
- Поддержка мобильных устройств для страницы /shop/ (цены, количество, кнопка корзины)
- Категория misc полностью исключена из всех публичных запросов товаров

### Технические детали
- Использованы CSS переменные из variables.css для всех новых стилей
- Production-ready код без описательных комментариев
- Модульная архитектура для легкого обслуживания
- Полная поддержка мобильных устройств (responsive design)
- AJAX обновление всех счетчиков в реальном времени
- Плавные анимации появления/исчезновения для всех интерактивных элементов